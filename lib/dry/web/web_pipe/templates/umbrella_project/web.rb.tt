require "dry/web/web_pipe/application"
require_relative "container"

module <%= config[:camel_cased_app_name] %>
  class Web < Dry::Web::WebPipe::Application
    configure do |config|
      config.container = Container
    end

    plugin :error_handler

    route do |r|
      r.run <%= config[:camel_cased_app_name] %>::Main::Web.freeze.app
    end

    error do |e|
      self.class[:rack_monitor].instrument(:error, exception: e)
      raise e
    end
  end
end
